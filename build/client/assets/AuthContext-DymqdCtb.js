import{a as u,o as C}from"./chunk-QMGIS6GS-u2wsVBQ8.js";import{A as a}from"./auth-DssmCHyn.js";const i=u.createContext(void 0),M=({children:n})=>{const[o,r]=u.useState(()=>{if(typeof window>"u")return null;const e=localStorage.getItem("na-mesa-ja:user");return e?JSON.parse(e):null}),d=!!o?.token,l=a.useCreateUser(),w=a.useLogin(),f=a.useForgotPassword(),m=a.useVerify2FA(),g=a.useResetPassword(),y=a.useChangePassword(),A=async({email:e,password:s})=>{const t=await w.mutateAsync({email:e,password:s});return t.status&&(r(t.data),localStorage.setItem("na-mesa-ja:user",JSON.stringify(t.data))),t},h=()=>{r(null),localStorage.removeItem("na-mesa-ja:user")},p=async({name:e,email:s,confirmEmail:t,password:c})=>await l.mutateAsync({name:e,email:s,confirmEmail:t,password:c}),P=async({twoFactorCode:e})=>{const s=await m.mutateAsync({userGuid:o?.userGuid??"",twoFactorCode:e});if(!s.status)return s;const t={...o,...s.data};return r(t),localStorage.setItem("na-mesa-ja:user",JSON.stringify(t)),s},S=async({email:e})=>await f.mutateAsync({email:e}),v=async({userGuid:e,newPassword:s,confirmPassword:t})=>await g.mutateAsync({userGuid:e,newPassword:s,confirmPassword:t}),x=async({userGuid:e,currentPassword:s,newPassword:t,confirmPassword:c})=>await y.mutateAsync({userGuid:e,currentPassword:s,newPassword:t,confirmPassword:c});u.useEffect(()=>{if(typeof window>"u")return;const e=s=>{if(s.key==="na-mesa-ja:user"){if(s.newValue===null)r(null);else if(s.newValue)try{const t=JSON.parse(s.newValue);r(t)}catch(t){console.error("Failed to parse user data from localStorage:",t),r(null)}}};return window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)},[]);const j={user:o,isAuthenticated:d,setUser:r,login:A,logout:h,register:p,forgotPassword:S,resetPassword:v,verify2FA:P,changePassword:x};return C.jsx(i.Provider,{value:j,children:n})},I=()=>{const n=u.useContext(i);if(n===void 0)throw new Error("useAuth must be used within an AuthProvider");return n};export{M as A,I as u};
